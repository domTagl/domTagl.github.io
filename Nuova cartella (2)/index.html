<!DOCTYPE html>
<html>
<head>
  <title>Campo Minato</title>
  <!-- Importa la libreria jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <!-- Definizione dello stile CSS -->
  <style>
    #campo-minato {
      display: grid;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(10, 1fr);
      width: 500px;
      height: 500px;
    }
    
    /* Definisce lo stile di ogni casella */
    .casella {
      border: 1px solid black;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      background-color: green; /* Aggiunge il colore verde di sfondo */
      color: transparent; /* Rende il testo al suo interno non visibile */
    }
    
    /* Definisce lo stile della casella contenente la bomba */
    .bomba {
      color: green;
    }
    
    /* Aggiunge la regola per mostrare il testo al clic */
    .casella.clickedSX {
      background-color: transparent;
      color: black;
    }

    /* Aggiunge la regola per mostrare il testo al clic */
    .casella.clickedDX {
      background-color: orange;
      color: transparent; /* Rende il testo al suo interno non visibile */
    }
  </style>
  <!-- Definizione dello script JavaScript -->
  <script>
    function creaCampo() {
      let difficoltà = 0;

      if (document.getElementById("mode").value == "1") {
        difficoltà = 3;
      }
      if (document.getElementById("mode").value == '2') {
        difficoltà = 7;
      }
      if (document.getElementById("mode").value == "3") {
        difficoltà = 10;
      }




      var campo = $("#campo-minato"); // seleziona il div contenitore del campo
      campo.empty(); // svuota il contenitore
      var campoMatrice = []; // matrice per rappresentare il campo minato
      for (var i = 0; i < 10; i++) {
        campoMatrice[i] = []; // inizializza una riga vuota nella matrice
        for (var j = 0; j < 10; j++) {
          campoMatrice[i][j] = " "; // inizializza a 0 il numero di mine adiacenti
        }
      }
      var mine = [];
      for (var i = 0; i < difficoltà; i++) {
        var x = Math.floor(Math.random() * difficoltà); // genera una coordinata x casuale
        var y = Math.floor(Math.random() * difficoltà); // genera una coordinata y casuale
        mine.push([x, y]); // aggiungi la posizione della mina all'array delle mine
        // incrementa il contatore di tutte le celle adiacenti
        for (var a = Math.max(0, x - 1); a <= Math.min(9, x + 1); a++) {
          for (var b = Math.max(0, y - 1); b <= Math.min(9, y + 1); b++) {
            campoMatrice[a][b]++; // incrementa il contatore di mine adiacenti
          }
        }
      }
      for (var i = 0; i < 100; i++) {
        var casella = $("<div/>"); // crea un elemento div per rappresentare la casella
        casella.addClass("casella"); // aggiungi la classe "casella" all'elemento
        var x = Math.floor(i / 10); // calcola la riga della casella corrente
        var y = i % 10; // calcola la colonna della casella corrente
        if (mine.some(m => m[0] === x && m[1] === y)) { // se la casella contiene una mina
          casella.addClass("bomba"); // aggiungi la classe "bomba" all'elemento
          casella.text("B"); // aggiungi il testo "M" all'elemento
        } else {
          casella.text(campoMatrice[x][y]); // aggiungi il numero di mine adiacenti come testo dell'elemento
        }
        campo.append(casella); // aggiungi l'elemento al contenitore del campo
      }
    }
    
  </script>

  <script>
    function setMine(){
      let input = 0;
      if (document.getElementById("mode").value == "1") 
        input = 3;
      if (document.getElementById("mode").value == '2') 
        input = 7;
      if (document.getElementById("mode").value == "3") 
        input = 10;
      document.getElementById("numMine").value = input;
      }
  </script>

  <script>
	  $(document).on("mousedown", ".casella", function(event) {
		if (event.which == 1) { // verifica che il click sia stato effettuato col tasto sinistro
		   $(this).addClass("clickedSX");
       if($(this).text() == "B"){
        $(this).addClass("clickedSX");
        setTimeout(perso, 100);
      }
		}
    if (event.which == 3) { // verifica che il click sia stato effettuato col tasto destro
      if ($(this).hasClass("clickedDX")) {
        $(this).removeClass("clickedDX").addClass("casella");
      } else {
        $(this).addClass("clickedDX");
      }
    }
	  });
	</script>
  
    <script>
    function perso(){
       alert("La bomba e' stata schiacciata, hai perso"); 
    }
  </script>
    

</head>
<body>
  
  <select id="mode" onclick="setMine()">
    <option value="1">easy mode</option>
    <option value="2">medium mode</option>
    <option value="3" selected>hard mode</option>>
  </select>

  MINE: <input type="text" value="10" id="numMine" size="1">

  <!-- Aggiunge un bottone per creare il campo minato -->
  <input type="button" onclick="creaCampo()" value="Crea campo">
  <!-- Crea un div vuoto con id "campo-minato" dove verranno aggiunte le caselle -->
  <div id="campo-minato"></div>
  

</body>
</html>